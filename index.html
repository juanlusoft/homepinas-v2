<!DOCTYPE html>
<html lang="es" data-theme="light" data-lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>HomePiNAS | Centro de Control Premium</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="HomePiNAS">
    <meta name="description" content="Premium Dashboard for Your Home NAS - Manage Docker, Storage, Network and System">
    <meta name="theme-color" content="#84cc16" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#0a0a0a" media="(prefers-color-scheme: dark)">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HomePiNAS">
    <meta name="msapplication-TileColor" content="#84cc16">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Favicons & Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon.png">
    <link rel="mask-icon" href="icons/icon.svg" color="#84cc16">
    <link rel="shortcut icon" href="frontend/logo.svg">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    
    <!-- Stylesheets -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="frontend/style.css">
    <link rel="stylesheet" href="frontend/responsive.css">
    <!-- xterm.js for web terminal -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css">
</head>

<body>
    <!-- Mobile Menu Toggle (Hamburger) -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Abrir men√∫" aria-expanded="false">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <!-- Sidebar Overlay for Mobile -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <!-- Settings Controls (Theme + Language) -->
    <div class="settings-controls" id="settings-controls">
        <button class="settings-btn" id="lang-toggle" title="Cambiar idioma">
            üåê
        </button>
        <button class="settings-btn" id="theme-toggle" title="Cambiar tema">
            üåô
        </button>
    </div>

    <div id="app">
        <!-- Setup View (Visible if no account exists) -->
        <div id="setup-view" class="view">
            <div class="glass-card login-card">
                <div class="brand">
                    <div class="logo-orb"></div>
                    <h1 data-i18n="auth.initializeNAS">Inicializar NAS</h1>
                    <p data-i18n="auth.createCredentials">Crear Credenciales de Administrador</p>
                </div>
                <form id="setup-form">
                    <div class="input-group">
                        <input type="text" id="new-username" required placeholder=" ">
                        <label for="new-username" data-i18n="auth.adminUsername">Usuario Administrador</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="new-password" required placeholder=" ">
                        <label for="new-password" data-i18n="auth.newSecurityKey">Nueva Clave de Seguridad</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="accept-terms" required>
                        <label for="accept-terms"><span data-i18n="auth.acceptTerms">Acepto los</span> <a href="#" id="terms-link" data-i18n="auth.termsAndConditions">t√©rminos y condiciones</a> <span data-i18n="auth.ofUse">de uso</span></label>
                    </div>
                    <button type="submit" class="btn-primary" data-i18n="auth.initializeGateway">Inicializar Sistema</button>
                </form>
            </div>
        </div>

        <!-- Storage Setup View (Wizard) -->
        <div id="storage-view" class="view">
            <div class="glass-card storage-card storage-wizard">
                <div class="brand" style="margin-bottom: 24px;">
                    <div class="logo-orb"></div>
                    <h1 data-i18n="wizard.title">Configuraci√≥n de Almacenamiento</h1>
                </div>

                <!-- Wizard Progress Indicator -->
                <div class="wizard-progress" id="wizard-progress">
                    <div class="wizard-progress-step">
                        <div class="wizard-progress-dot active" data-step="1">1</div>
                    </div>
                    <div class="wizard-progress-line"></div>
                    <div class="wizard-progress-step">
                        <div class="wizard-progress-dot" data-step="2">2</div>
                    </div>
                    <div class="wizard-progress-line"></div>
                    <div class="wizard-progress-step">
                        <div class="wizard-progress-dot" data-step="3">3</div>
                    </div>
                    <div class="wizard-progress-line"></div>
                    <div class="wizard-progress-step">
                        <div class="wizard-progress-dot" data-step="4">4</div>
                    </div>
                    <div class="wizard-progress-line"></div>
                    <div class="wizard-progress-step">
                        <div class="wizard-progress-dot" data-step="5">5</div>
                    </div>
                </div>

                <div class="wizard-container" id="wizard-container">
                    <!-- Step 1: Welcome + Disk Detection -->
                    <div class="wizard-step active" data-step="1">
                        <div class="wizard-step-header">
                            <span class="wizard-step-icon">üëã</span>
                            <h2 class="wizard-step-title" data-i18n="wizard.welcomeTitle">¬°Bienvenido a HomePiNAS!</h2>
                            <p class="wizard-step-subtitle" data-i18n="wizard.welcomeSubtitle">Vamos a configurar tu almacenamiento en unos simples pasos</p>
                        </div>
                        
                        <div class="wizard-info-box">
                            <span class="wizard-info-box-icon">üí°</span>
                            <div class="wizard-info-box-text" data-i18n="wizard.infoSnapraid">
                                HomePiNAS usa SnapRAID + MergerFS para combinar m√∫ltiples discos en un √∫nico pool de almacenamiento con protecci√≥n opcional contra fallos.
                            </div>
                        </div>
                        
                        <div id="wizard-disk-detection">
                            <div class="wizard-detecting">
                                <div class="wizard-spinner"></div>
                                <p class="wizard-detecting-text" data-i18n="wizard.detectingDisks">Detectando discos conectados...</p>
                            </div>
                        </div>

                        <div class="wizard-nav">
                            <div></div>
                            <button class="wizard-btn wizard-btn-next" id="wizard-next-1" disabled data-i18n="wizard.next">
                                Siguiente ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Data Disk Selection -->
                    <div class="wizard-step" data-step="2">
                        <div class="wizard-step-header">
                            <span class="wizard-step-icon">üíæ</span>
                            <h2 class="wizard-step-title" data-i18n="wizard.dataDisksTitle">Selecciona Discos de Datos</h2>
                            <p class="wizard-step-subtitle" data-i18n="wizard.dataDisksSubtitle">Estos discos almacenar√°n tus archivos (selecciona al menos uno)</p>
                        </div>
                        
                        <div class="wizard-disk-list" id="wizard-data-disks">
                            <!-- Data disk cards will be injected here -->
                        </div>

                        <div class="wizard-info-box warning">
                            <span class="wizard-info-box-icon">‚ö†Ô∏è</span>
                            <div class="wizard-info-box-text" data-i18n="wizard.formatWarning">
                                Los discos seleccionados ser√°n FORMATEADOS. Aseg√∫rate de hacer backup de cualquier dato importante.
                            </div>
                        </div>

                        <div class="wizard-nav">
                            <button class="wizard-btn wizard-btn-back" id="wizard-back-2" data-i18n="wizard.back">
                                ‚Üê Atr√°s
                            </button>
                            <button class="wizard-btn wizard-btn-next" id="wizard-next-2" disabled data-i18n="wizard.next">
                                Siguiente ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Parity Disk Selection -->
                    <div class="wizard-step" data-step="3">
                        <div class="wizard-step-header">
                            <span class="wizard-step-icon">üõ°Ô∏è</span>
                            <h2 class="wizard-step-title" data-i18n="wizard.parityDiskTitle">Disco de Paridad (Opcional)</h2>
                            <p class="wizard-step-subtitle" data-i18n="wizard.parityDiskSubtitle">Protege tus datos contra fallos de disco con SnapRAID</p>
                        </div>
                        
                        <div class="wizard-info-box">
                            <span class="wizard-info-box-icon">üí°</span>
                            <div class="wizard-info-box-text" data-i18n="wizard.parityInfo">
                                El disco de paridad debe ser IGUAL O MAYOR que el disco de datos m√°s grande. Permite recuperar datos si falla un disco.
                            </div>
                        </div>
                        
                        <div class="wizard-disk-list" id="wizard-parity-disks">
                            <!-- Parity disk cards will be injected here -->
                        </div>

                        <button class="wizard-skip-btn" id="wizard-skip-parity" data-i18n="wizard.skipParity">
                            Omitir - No necesito protecci√≥n de paridad
                        </button>

                        <div class="wizard-nav">
                            <button class="wizard-btn wizard-btn-back" id="wizard-back-3" data-i18n="wizard.back">
                                ‚Üê Atr√°s
                            </button>
                            <button class="wizard-btn wizard-btn-next" id="wizard-next-3" data-i18n="wizard.next">
                                Siguiente ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Cache Disk Selection -->
                    <div class="wizard-step" data-step="4">
                        <div class="wizard-step-header">
                            <span class="wizard-step-icon">‚ö°</span>
                            <h2 class="wizard-step-title" data-i18n="wizard.cacheDiskTitle">Disco de Cach√© (Opcional)</h2>
                            <p class="wizard-step-subtitle" data-i18n="wizard.cacheDiskSubtitle">Un SSD/NVMe acelera el acceso a archivos frecuentes</p>
                        </div>
                        
                        <div class="wizard-disk-list" id="wizard-cache-disks">
                            <!-- Cache disk cards will be injected here -->
                        </div>

                        <div id="wizard-no-cache-disks" class="wizard-no-disks" style="display: none;">
                            <div class="wizard-no-disks-icon">üíø</div>
                            <p data-i18n="wizard.noCacheDisks">No hay discos SSD/NVMe disponibles para cach√©</p>
                        </div>

                        <button class="wizard-skip-btn" id="wizard-skip-cache" data-i18n="wizard.skipCache">
                            Omitir - No necesito cach√©
                        </button>

                        <div class="wizard-nav">
                            <button class="wizard-btn wizard-btn-back" id="wizard-back-4" data-i18n="wizard.back">
                                ‚Üê Atr√°s
                            </button>
                            <button class="wizard-btn wizard-btn-next" id="wizard-next-4" data-i18n="wizard.next">
                                Siguiente ‚Üí
                            </button>
                        </div>
                    </div>

                    <!-- Step 5: Summary + Create -->
                    <div class="wizard-step" data-step="5">
                        <div class="wizard-step-header">
                            <span class="wizard-step-icon">üìã</span>
                            <h2 class="wizard-step-title" data-i18n="wizard.summaryTitle">Resumen de Configuraci√≥n</h2>
                            <p class="wizard-step-subtitle" data-i18n="wizard.summarySubtitle">Revisa tu configuraci√≥n antes de crear el pool</p>
                        </div>
                        
                        <div class="wizard-summary" id="wizard-summary">
                            <div class="wizard-summary-section">
                                <div class="wizard-summary-label" data-i18n="wizard.dataDisks">Discos de Datos</div>
                                <div class="wizard-summary-value" id="summary-data-disks">
                                    <!-- Data disk badges will be injected here -->
                                </div>
                            </div>
                            <div class="wizard-summary-section">
                                <div class="wizard-summary-label" data-i18n="wizard.parityDisk">Disco de Paridad</div>
                                <div class="wizard-summary-value" id="summary-parity-disk">
                                    <!-- Parity disk badge will be injected here -->
                                </div>
                            </div>
                            <div class="wizard-summary-section">
                                <div class="wizard-summary-label" data-i18n="wizard.cacheDisk">Disco de Cach√©</div>
                                <div class="wizard-summary-value" id="summary-cache-disk">
                                    <!-- Cache disk badge will be injected here -->
                                </div>
                            </div>
                            <div class="wizard-summary-total">
                                <span class="wizard-summary-total-label" data-i18n="wizard.totalCapacity">Capacidad Total:</span>
                                <span class="wizard-summary-total-value" id="summary-total-capacity">0 TB</span>
                            </div>
                        </div>

                        <div class="wizard-info-box warning">
                            <span class="wizard-info-box-icon">‚ö†Ô∏è</span>
                            <div class="wizard-info-box-text" data-i18n="wizard.createWarning">
                                Al hacer clic en "Crear Pool", los discos seleccionados ser√°n formateados. Este proceso puede tardar varios minutos.
                            </div>
                        </div>

                        <div class="wizard-nav">
                            <button class="wizard-btn wizard-btn-back" id="wizard-back-5" data-i18n="wizard.back">
                                ‚Üê Atr√°s
                            </button>
                            <button class="wizard-btn wizard-btn-create" id="wizard-create-pool" data-i18n="wizard.createPool">
                                üöÄ Crear Pool de Almacenamiento
                            </button>
                        </div>
                    </div>

                    <!-- Step 6: Progress -->
                    <div class="wizard-step" data-step="6">
                        <div class="wizard-step-header">
                            <span class="wizard-step-icon">‚öôÔ∏è</span>
                            <h2 class="wizard-step-title" data-i18n="wizard.progressTitle">Configurando Pool...</h2>
                            <p class="wizard-step-subtitle" data-i18n="wizard.progressSubtitle">Por favor, no cierres esta ventana</p>
                        </div>
                        
                        <div class="wizard-progress-list" id="wizard-progress-list">
                            <div class="wizard-progress-item" data-task="format">
                                <div class="wizard-progress-icon pending">‚è≥</div>
                                <div class="wizard-progress-text">
                                    <div class="wizard-progress-title" data-i18n="wizard.taskFormat">Formateando discos</div>
                                    <div class="wizard-progress-status" data-i18n="wizard.pending">Pendiente</div>
                                </div>
                            </div>
                            <div class="wizard-progress-item" data-task="mount">
                                <div class="wizard-progress-icon pending">‚è≥</div>
                                <div class="wizard-progress-text">
                                    <div class="wizard-progress-title" data-i18n="wizard.taskMount">Montando particiones</div>
                                    <div class="wizard-progress-status" data-i18n="wizard.pending">Pendiente</div>
                                </div>
                            </div>
                            <div class="wizard-progress-item" data-task="snapraid">
                                <div class="wizard-progress-icon pending">‚è≥</div>
                                <div class="wizard-progress-text">
                                    <div class="wizard-progress-title" data-i18n="wizard.taskSnapraid">Configurando SnapRAID</div>
                                    <div class="wizard-progress-status" data-i18n="wizard.pending">Pendiente</div>
                                </div>
                            </div>
                            <div class="wizard-progress-item" data-task="mergerfs">
                                <div class="wizard-progress-icon pending">‚è≥</div>
                                <div class="wizard-progress-text">
                                    <div class="wizard-progress-title" data-i18n="wizard.taskMergerfs">Configurando MergerFS</div>
                                    <div class="wizard-progress-status" data-i18n="wizard.pending">Pendiente</div>
                                </div>
                            </div>
                            <div class="wizard-progress-item" data-task="fstab">
                                <div class="wizard-progress-icon pending">‚è≥</div>
                                <div class="wizard-progress-text">
                                    <div class="wizard-progress-title" data-i18n="wizard.taskFstab">Actualizando /etc/fstab</div>
                                    <div class="wizard-progress-status" data-i18n="wizard.pending">Pendiente</div>
                                </div>
                            </div>
                            <div class="wizard-progress-item" data-task="sync">
                                <div class="wizard-progress-icon pending">‚è≥</div>
                                <div class="wizard-progress-text">
                                    <div class="wizard-progress-title" data-i18n="wizard.taskSync">Sincronizaci√≥n inicial</div>
                                    <div class="wizard-progress-status" data-i18n="wizard.pending">Pendiente</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 7: Completed -->
                    <div class="wizard-step" data-step="7">
                        <div class="wizard-completed">
                            <div class="wizard-completed-icon">üéâ</div>
                            <h2 class="wizard-completed-title" data-i18n="wizard.completedTitle">¬°Pool Creado Exitosamente!</h2>
                            <p class="wizard-completed-subtitle" data-i18n="wizard.completedSubtitle">Tu almacenamiento est√° listo para usar</p>
                            <div class="wizard-completed-path">/mnt/storage</div>
                        </div>

                        <div class="wizard-nav" style="justify-content: center;">
                            <button class="wizard-btn wizard-btn-next" id="wizard-go-dashboard" data-i18n="wizard.goToDashboard">
                                Ir al Dashboard ‚Üí
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Login View (Visible if account exists) -->
        <div id="login-view" class="view">
            <div class="glass-card login-card">
                <div class="brand">
                    <div class="logo-orb"></div>
                    <h1>HomePiNAS</h1>
                    <p data-i18n="auth.secureGateway">Portal Seguro Empresarial</p>
                </div>
                <form id="login-form">
                    <div class="input-group">
                        <input type="text" id="username" required placeholder=" ">
                        <label for="username" data-i18n="auth.username">Usuario</label>
                    </div>
                    <div class="input-group">
                        <input type="password" id="password" required placeholder=" ">
                        <label for="password" data-i18n="auth.securityKey">Clave de Seguridad</label>
                    </div>
                    <div id="totp-input-group" class="input-group" style="display: none;">
                        <input type="text" id="login-totp-code" maxlength="6" inputmode="numeric" pattern="[0-9]*" placeholder=" ">
                        <label for="login-totp-code">üîê C√≥digo 2FA</label>
                    </div>
                    <button type="submit" class="btn-primary" data-i18n="auth.accessGateway">Acceder al Sistema</button>
                    <button type="button" id="reset-setup-btn" class="btn-link"
                        style="margin-top: 15px; color: var(--text-dim); background: none; border: none; cursor: pointer; font-size: 0.8rem;"
                        data-i18n="auth.resetSetupData">Restablecer Configuraci√≥n</button>
                </form>
            </div>
        </div>

        <!-- Dashboard View (Hidden by default) -->
        <div id="dashboard-view" class="view dashboard-wrapper">
            <!-- Top Header Bar (Synology-style) -->
            <header class="top-header">
                <div class="top-header-left">
                    <button class="header-btn sidebar-toggle" id="sidebar-toggle" title="Toggle sidebar">‚ò∞</button>
                    <div class="top-header-logo">
                        <span>HomePiNAS</span>
                    </div>
                </div>
                <div class="header-search">
                    <input type="text" id="global-search" placeholder="Buscar..." data-i18n-placeholder="search.placeholder">
                </div>
                <div class="top-header-right">
                    <button class="header-btn" id="header-notifications" title="Notificaciones">üîî</button>
                    <button class="header-btn" id="header-theme-toggle" title="Cambiar tema">üåô</button>
                    <div class="header-user" id="header-user-menu">
                        <div class="header-user-avatar" id="user-avatar-letter">U</div>
                        <span class="header-user-name" id="username-display">Usuario</span>
                    </div>
                    <button class="header-btn" id="logout-btn" title="Cerrar sesi√≥n">‚èª</button>
                </div>
            </header>

            <div class="dashboard-body">
                <!-- Sidebar Navigation -->
                <nav class="sidebar" id="main-sidebar">
                    <div class="sidebar-section">Principal</div>
                    <ul class="nav-links">
                        <li class="active" data-view="dashboard">
                            <span class="nav-icon">üìä</span>
                            <span class="nav-text" data-i18n="nav.overview">Resumen</span>
                        </li>
                        <li data-view="files">
                            <span class="nav-icon">üìÅ</span>
                            <span class="nav-text" data-i18n="nav.files">File Station</span>
                        </li>
                        <li data-view="storage">
                            <span class="nav-icon">üíæ</span>
                            <span class="nav-text" data-i18n="nav.storage">Almacenamiento</span>
                        </li>
                    </ul>
                    
                    <div class="sidebar-section">Servicios</div>
                    <ul class="nav-links">
                        <li data-view="docker">
                            <span class="nav-icon">üê≥</span>
                            <span class="nav-text" data-i18n="nav.docker">Docker</span>
                        </li>
                        <li data-view="cloud-sync">
                            <span class="nav-icon">üîÑ</span>
                            <span class="nav-text" data-i18n="nav.cloudSync">Cloud Sync</span>
                        </li>
                        <li data-view="cloud-backup">
                            <span class="nav-icon">‚òÅÔ∏è</span>
                            <span class="nav-text" data-i18n="nav.cloudBackup">Cloud Backup</span>
                        </li>
                        <li data-view="homestore">
                            <span class="nav-icon">üè™</span>
                            <span class="nav-text" data-i18n="nav.homestore">HomeStore</span>
                        </li>
                        <li data-view="backup">
                            <span class="nav-icon">üì¶</span>
                            <span class="nav-text" data-i18n="nav.backup">Backup</span>
                        </li>
                        <li data-view="active-backup">
                            <span class="nav-icon">üîÑ</span>
                            <span class="nav-text" data-i18n="nav.activeBackup">Active Backup</span>
                        </li>
                        <li data-view="active-directory">
                            <span class="nav-icon">üè¢</span>
                            <span class="nav-text" data-i18n="nav.activeDirectory">Active Directory</span>
                        </li>
                    </ul>
                    
                    <div class="sidebar-section">Sistema</div>
                    <ul class="nav-links">
                        <li data-view="network">
                            <span class="nav-icon">üåê</span>
                            <span class="nav-text" data-i18n="nav.network">Red</span>
                        </li>
                        <li data-view="users">
                            <span class="nav-icon">üë•</span>
                            <span class="nav-text" data-i18n="nav.users">Usuarios</span>
                        </li>
                        <li data-view="terminal">
                            <span class="nav-icon">üíª</span>
                            <span class="nav-text" data-i18n="nav.terminal">Terminal</span>
                        </li>
                        <li data-view="logs">
                            <span class="nav-icon">üìã</span>
                            <span class="nav-text" data-i18n="nav.logs">Logs</span>
                        </li>
                        <li data-view="system">
                            <span class="nav-icon">‚öôÔ∏è</span>
                            <span class="nav-text" data-i18n="nav.system">Sistema</span>
                        </li>
                    </ul>
                    
                    <!-- Logo at bottom -->
                    <div class="sidebar-logo">
                        <img src="frontend/logo.svg" alt="HomePiNAS">
                        <span class="sidebar-logo-text">HomePiNAS</span>
                    </div>
                </nav>

                <!-- Main Content Area -->
                <main class="content" id="main-content">
                    <div class="page-header">
                        <h1 class="page-title" id="view-title" data-i18n="dashboard.systemOverview">Resumen del Sistema</h1>
                    </div>
                    <div id="dashboard-content" class="grid-container">
                        <!-- Dynamic Content -->
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Storage Progress Modal -->
    <div id="storage-progress-modal" class="modal">
        <div class="glass-card modal-content storage-progress">
            <header class="modal-header">
                <h3>üîß <span data-i18n="progress.configuringPool">Configurando Pool de Almacenamiento</span></h3>
            </header>
            <div class="progress-container">
                <div class="progress-step" id="step-format">
                    <span class="step-icon">‚è≥</span>
                    <span class="step-text" data-i18n="progress.formattingDisks">Formateando discos...</span>
                </div>
                <div class="progress-step" id="step-mount">
                    <span class="step-icon">‚è≥</span>
                    <span class="step-text" data-i18n="progress.mountingPartitions">Montando particiones...</span>
                </div>
                <div class="progress-step" id="step-snapraid">
                    <span class="step-icon">‚è≥</span>
                    <span class="step-text" data-i18n="progress.creatingSnapraid">Creando configuraci√≥n SnapRAID...</span>
                </div>
                <div class="progress-step" id="step-mergerfs">
                    <span class="step-icon">‚è≥</span>
                    <span class="step-text" data-i18n="progress.configuringMergerfs">Configurando pool MergerFS...</span>
                </div>
                <div class="progress-step" id="step-fstab">
                    <span class="step-icon">‚è≥</span>
                    <span class="step-text" data-i18n="progress.updatingFstab">Actualizando /etc/fstab...</span>
                </div>
                <div class="progress-step" id="step-sync">
                    <span class="step-icon">‚è≥</span>
                    <span class="step-text" data-i18n="progress.initialSync">Sincronizaci√≥n inicial SnapRAID...</span>
                    <div class="sync-progress-bar">
                        <div class="sync-progress-fill" id="sync-progress-fill"></div>
                    </div>
                    <span class="sync-status" id="sync-status"></span>
                </div>
            </div>
            <div class="progress-footer">
                <p id="progress-message" data-i18n="progress.pleaseWait">Por favor espera, esto puede tardar varios minutos...</p>
            </div>
        </div>
    </div>

    <!-- DDNS Modal is now created dynamically in main.js -->

    <!-- Terms and Conditions Modal -->
    <div id="terms-modal" class="modal">
        <div class="glass-card modal-content terms-content">
            <header class="modal-header">
                <h3 data-i18n="terms.title">T√©rminos y Condiciones de Uso</h3>
                <button id="close-terms-modal" class="btn-close">&times;</button>
            </header>
            <div class="terms-body">
                <h4>1. <span data-i18n="terms.acceptance">Aceptaci√≥n de los T√©rminos</span></h4>
                <p data-i18n="terms.acceptanceText">Al utilizar HomePiNAS, aceptas estos t√©rminos y condiciones en su totalidad. Si no est√°s de acuerdo con alguna parte, no debes utilizar este software.</p>

                <h4>2. <span data-i18n="terms.description">Descripci√≥n del Servicio</span></h4>
                <p data-i18n="terms.descriptionText">HomePiNAS es un software de gesti√≥n de almacenamiento NAS para Raspberry Pi. El software se proporciona "tal cual" sin garant√≠as de ning√∫n tipo.</p>

                <h4>3. <span data-i18n="terms.usage">Uso del Software</span></h4>
                <p data-i18n="terms.usageText">El usuario es responsable de:</p>
                <ul>
                    <li data-i18n="terms.usageItem1">Mantener copias de seguridad de sus datos importantes</li>
                    <li data-i18n="terms.usageItem2">La seguridad de sus credenciales de acceso</li>
                    <li data-i18n="terms.usageItem3">El uso adecuado del hardware y software</li>
                    <li data-i18n="terms.usageItem4">Cumplir con las leyes aplicables en su jurisdicci√≥n</li>
                </ul>

                <h4>4. <span data-i18n="terms.liability">Limitaci√≥n de Responsabilidad</span></h4>
                <p data-i18n="terms.liabilityText">HomePiNAS y sus desarrolladores no ser√°n responsables de:</p>
                <ul>
                    <li data-i18n="terms.liabilityItem1">P√©rdida de datos por cualquier motivo</li>
                    <li data-i18n="terms.liabilityItem2">Da√±os al hardware</li>
                    <li data-i18n="terms.liabilityItem3">Interrupciones del servicio</li>
                    <li data-i18n="terms.liabilityItem4">Accesos no autorizados debido a configuraciones del usuario</li>
                </ul>

                <h4>5. <span data-i18n="terms.privacy">Privacidad</span></h4>
                <p data-i18n="terms.privacyText">HomePiNAS no recopila ni env√≠a datos personales a servidores externos. Todos los datos se almacenan localmente en tu dispositivo.</p>

                <h4>6. <span data-i18n="terms.modifications">Modificaciones</span></h4>
                <p data-i18n="terms.modificationsText">Nos reservamos el derecho de modificar estos t√©rminos en cualquier momento. Los cambios ser√°n efectivos inmediatamente despu√©s de su publicaci√≥n.</p>

                <h4>7. <span data-i18n="terms.contact">Contacto</span></h4>
                <p><span data-i18n="terms.contactText">Para cualquier consulta sobre estos t√©rminos, visita</span> <a href="https://homelabs.club" target="_blank">homelabs.club</a></p>
            </div>
            <div class="modal-footer">
                <button id="accept-terms-btn" class="btn-primary" data-i18n="terms.understood">Entendido</button>
            </div>
        </div>
    </div>

    <!-- Terminal Modal -->
    <div id="terminal-modal" class="modal">
        <div class="glass-card modal-content terminal-modal-content">
            <header class="modal-header">
                <h3>üíª <span data-i18n="terminal.title">Terminal Web</span></h3>
                <div class="terminal-controls">
                    <button id="terminal-fullscreen" class="btn-sm" title="Pantalla completa">‚õ∂</button>
                    <button id="close-terminal-modal" class="btn-close">&times;</button>
                </div>
            </header>
            <div id="terminal-container" class="terminal-container">
                <!-- xterm.js terminal will be rendered here -->
            </div>
            <div class="terminal-status">
                <span id="terminal-status-text" data-i18n="terminal.connecting">Conectando...</span>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.min.js"></script>
    
    <!-- Theme and Language Toggle Script -->
    <script>
        (function() {
            const html = document.documentElement;
            const themeToggle = document.getElementById('theme-toggle');
            const langToggle = document.getElementById('lang-toggle');

            // Load saved theme or default to light
            const savedTheme = localStorage.getItem('homepinas-theme') || 'light';
            html.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);

            // Load saved language or default to Spanish
            const savedLang = localStorage.getItem('homepinas-lang') || 'es';
            html.setAttribute('data-lang', savedLang);
            html.setAttribute('lang', savedLang);
            updateLangIcon(savedLang);

            themeToggle.addEventListener('click', () => {
                const current = html.getAttribute('data-theme');
                const next = current === 'light' ? 'dark' : 'light';
                html.setAttribute('data-theme', next);
                localStorage.setItem('homepinas-theme', next);
                updateThemeIcon(next);
            });

            langToggle.addEventListener('click', () => {
                const current = html.getAttribute('data-lang') || 'es';
                const next = current === 'es' ? 'en' : 'es';
                html.setAttribute('data-lang', next);
                html.setAttribute('lang', next);
                localStorage.setItem('homepinas-lang', next);
                updateLangIcon(next);
                // Trigger i18n update event
                window.dispatchEvent(new CustomEvent('langchange', { detail: { lang: next } }));
            });

            function updateThemeIcon(theme) {
                themeToggle.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
                themeToggle.title = theme === 'light' ? 'Modo oscuro' : 'Modo claro';
            }

            function updateLangIcon(lang) {
                langToggle.textContent = lang === 'es' ? 'üá™üá∏' : 'üá¨üáß';
                langToggle.title = lang === 'es' ? 'Switch to English' : 'Cambiar a Espa√±ol';
            }
        })();
    </script>
    <script type="module" src="frontend/main.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('[PWA] Service Worker registered:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('[PWA] Service Worker update found');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New version available
                                    console.log('[PWA] New version available');
                                    // Could show update notification here
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('[PWA] Service Worker registration failed:', error);
                    });
            });
        }

        // Mobile Menu Toggle Handler
        document.addEventListener('DOMContentLoaded', () => {
            const menuToggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            function toggleMobileMenu() {
                const isOpen = sidebar?.classList.toggle('open');
                menuToggle?.classList.toggle('active', isOpen);
                overlay?.classList.toggle('active', isOpen);
                menuToggle?.setAttribute('aria-expanded', isOpen);
                
                // Prevent body scroll when menu is open
                document.body.style.overflow = isOpen ? 'hidden' : '';
            }
            
            function closeMobileMenu() {
                sidebar?.classList.remove('open');
                menuToggle?.classList.remove('active');
                overlay?.classList.remove('active');
                menuToggle?.setAttribute('aria-expanded', 'false');
                document.body.style.overflow = '';
            }
            
            menuToggle?.addEventListener('click', toggleMobileMenu);
            overlay?.addEventListener('click', closeMobileMenu);
            
            // Close menu when clicking nav links
            document.querySelectorAll('.nav-links li').forEach(link => {
                link.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        closeMobileMenu();
                    }
                });
            });
            
            // Close menu on window resize if larger than mobile
            window.addEventListener('resize', () => {
                if (window.innerWidth > 768) {
                    closeMobileMenu();
                }
            });
            
            // Handle escape key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && sidebar?.classList.contains('open')) {
                    closeMobileMenu();
                }
            });
        });

        // PWA Install Prompt Handler
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            console.log('[PWA] Install prompt available');
        });
    </script>
</body>

</html>
